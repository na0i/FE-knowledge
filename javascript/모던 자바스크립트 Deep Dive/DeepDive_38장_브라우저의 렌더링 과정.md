## 38장 브라우저의 렌더링 과정

브라우저의 렌더링 과정은 다음과 같다.

1. 브라우저는 렌더링에 필요한 리소스(HTML, CSS, JS, 이미지, 폰트 파일 등)을 요청하고 서버로부터 응답받는다.
2. 브라우저 렌더링 엔진은 서버로부터 응답된 HTML과 CSS를 파싱하여 DOM과 CSSOM을 생성하고 이를 결합해 렌더트리를 만든다.
3. 브라우저의 자바스크립트 엔진은 서버로부터 응답된 자바스크립트를 파싱해 AST를 생성하고 바이트코드로 변환해 실행한다. 자바스크립트에 의해 변경된 DOM과 CSSOM은 다시 렌더 트리로 결합된다.
4. 렌더 트리를 기반으로 HTML 요소의 레이아웃을 계산하고 브라우저 화면에 HTML 요소를 페인팅한다. 

> AST: abstract syntax tree

<br>

### 38.1 요청과 응답

브라우저의 핵심 기능은 **필요한 리소스를 서버에 요청하고 서버로부터 응답 받아 브라우저에 시각적으로 렌더링**하는 것이다.

- 필요한 리소스를 서버에 요청
- 응답받은 리소스를 파싱하여 렌더링

<br>

주소창에 URL 입력(루트요청) → (루트 요청에는 암묵적으로) index.html 반환

<br>

### 38.2 HTTP 1.1과 HTTP 2.0

HTTP는 웹에서 브라우저와 서버가 통신하기 위한 프로토콜이다.

##### HTTP/1.1
- 1999년 발표
- 기본적으로 커넥션당 하나의 요청과 응답만 처리한다.(여러개 처리 불가능)
- 리소스의 동시 전송이 불가능한 구조이므로 요청할 리소스 개수에 비례해 응답시간이 증가한다.

##### HTTP/2
- 2015년 발표
- 커넥션당 여러 개의 요청과 응답이 가능하다.(다중 요청/응답 가능)
- 리소스의 동시 전송이 가능하므로 HTTP/1.1에 비해 약 50%정도 로드 속도가 빠르다.

<br>

### 38.3 HTML 파싱과 DOM 생성

브라우저 요청에 의해 서버가 응답한 HTML 문서는 문자열로 이루어진 순수한 텍스트다. 이 순수한 텍스트를 브라우저에 픽셀로 렌더링하려면 이 HTML 문서를 **브라우저가 이해할 수 있는 자료구조로 변환**하여 메모리에 저장해야 한다.

![스크린샷 2023-05-10 오후 10 55 16](https://github.com/na0i/Algorithm-study/assets/77482972/0754bf3d-5c40-4360-acc7-d8850453ec54)

1. 서버에 존재하던 **HTML 파일이 브라우저 요청에 의해 응답**된다.
	- 서버는 HTML 파일을 메모리에 저장한 후
	- 메모리에 저장된 바이트(2진수)를 인터넷을 경유해 응답한다.
2. 브라우저는 **바이트 형태**의 HTML 문서를 응답받는다.
3. 응답된 HTML 문서는 meta 태그의 charset 어트리뷰터에 의해 **지정된 인코딩 방식(ex: UTF-8)을 기준으로 문자열로 변환**된다.
	- 인코딩 방식은 응답 헤더에 담겨 응답된다.
4. 문자열로 변환된 HTML 문서를 읽어들여 **토큰(문법적 의미를 갖는 코드의 최소 단위)으로 분해**한다.
5. 토큰들을 **객체로 변환**해 **노드(DOM을 구성하는 기본 요소가 된다.)들을 생성**한다.
6. HTML 요소 간의 부모자식 관계를 반영하여 모든 **노드들을 트리 자료구조로 구성**한다. 이를 DOM이라고 부른다.
	- HTML 요소는 중첩 관계를 가지며 중첩관계에 의해 부자관계가 설정된다.

<br>

`HTML 응답(바이트 형태) → 문자열로 변환 → 토큰으로 분해 → 객체로 변환 → 노드 생성 → 중첩관계 반영한 DOM 트리 생성`

<br>

> DOM(Document Object Model): HTML 문서를 파싱한 결과물

<br>

### 38.4 CSS 파싱과 CSSOM 생성

렌더링 엔진은 HTML을 처음부터 한 줄씩 순차적으로 파싱하여 DOM을 생성해 나간다. 그러던 도중 link 태그나 style 태그를 만나면(CSS를 로드하는 태그들) DOM 생성을 일시 중단한다.

<br>

link 태그(href 어트리뷰트에 지정된 CSS 파일을 서버에 요청)로 로드한 CSS 파일이나 style 태그 내의 CSS를 HTML과 동일한 파싱 과정(`바이트 → 문자 → 토큰 → 노드 → CSSOM`)을 거치며 해석하여 CSSOM을 생성한다.

<br>

CSS 파싱을 완료하면 HTML 파싱을 다시 시작하여 DOM 생성을 재개한다.

<br>

### 38.5 렌더 트리 생성

렌더링 엔진은 HTML과 CSS를 파싱하여 DOM과 CSSOM을 생성한다.